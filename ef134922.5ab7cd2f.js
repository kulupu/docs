(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{82:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return o})),t.d(n,"metadata",(function(){return c})),t.d(n,"toc",(function(){return l})),t.d(n,"default",(function(){return u}));var i=t(3),r=t(7),a=(t(0),t(85)),o={title:"Incidents"},c={unversionedId:"incident",id:"incident",isDocsHomePage:!1,title:"Incidents",description:"This page documents the past network incidents of the Kulupu",source:"@site/docs/incident.md",slug:"/incident",permalink:"/docs/incident",editUrl:"https://github.com/kulupu/docs/edit/master/website/docs/incident.md",version:"current",sidebar:"someSidebar",previous:{title:"Runtime",permalink:"/docs/runtime"},next:{title:"Do your own research",permalink:"/docs/dyor"}},l=[{value:"Decoding error in runtime dealing with multiple parameters",id:"decoding-error-in-runtime-dealing-with-multiple-parameters",children:[{value:"Impact",id:"impact",children:[]},{value:"Resolution",id:"resolution",children:[]}]},{value:"Missing runtime migration for the scheduler module",id:"missing-runtime-migration-for-the-scheduler-module",children:[{value:"Impact",id:"impact-1",children:[]},{value:"Resolution",id:"resolution-1",children:[]}]},{value:"Module index change in runtime upgrade",id:"module-index-change-in-runtime-upgrade",children:[{value:"Impact",id:"impact-2",children:[]},{value:"Resolution",id:"resolution-2",children:[]}]},{value:"Type definition incompatibility between UI and runtime",id:"type-definition-incompatibility-between-ui-and-runtime",children:[{value:"Impact",id:"impact-3",children:[]},{value:"Resolution",id:"resolution-3",children:[]}]}],d={toc:l};function u(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(i.a)({},d,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("p",null,"This page documents the past network incidents of the Kulupu\nblockchain."),Object(a.b)("h2",{id:"decoding-error-in-runtime-dealing-with-multiple-parameters"},"Decoding error in runtime dealing with multiple parameters"),Object(a.b)("p",null,Object(a.b)("em",{parentName:"p"},"Early August, 2020")),Object(a.b)("p",null,"In the ",Object(a.b)("em",{parentName:"p"},"Red Coast Base")," runtime upgrade, an overlooked PR in Substrate repo\nresulted in runtime decoding error for WebAssembly function exports. The issue\nwas fixed in Substrate\n",Object(a.b)("a",{parentName:"p",href:"https://github.com/paritytech/substrate/pull/6484"},"PR#6484"),". However, it did\nnot make it into the corresponding runtime upgrade."),Object(a.b)("h3",{id:"impact"},"Impact"),Object(a.b)("p",null,"Fortunately, the decoding error did not affect the core functionality\nof the blockchain. Two WebAssembly function exports use multiple\nparameters -- ",Object(a.b)("inlineCode",{parentName:"p"},"validate_transaction")," and ",Object(a.b)("inlineCode",{parentName:"p"},"check_inherents"),". Their\ncorresponding native variant does not suffer from the same decoding\nerror and can be used as alternatives to make sure the chain can\ncontinue to function."),Object(a.b)("h3",{id:"resolution"},"Resolution"),Object(a.b)("p",null,"The immediate temporary resolution was to ask miners to continue to\nuse version ",Object(a.b)("inlineCode",{parentName:"p"},"v1.2.0"),". That version has the corresponding native\nvariant of the runtime and the client will prefer to use them when\ncalling ",Object(a.b)("inlineCode",{parentName:"p"},"validate_transaction")," and ",Object(a.b)("inlineCode",{parentName:"p"},"check_inherents"),"."),Object(a.b)("p",null,"The root issue was fixed in the next ",Object(a.b)("em",{parentName:"p"},"Seeker Camp")," runtime upgrade\nwhere PR#6484 was included."),Object(a.b)("h2",{id:"missing-runtime-migration-for-the-scheduler-module"},"Missing runtime migration for the scheduler module"),Object(a.b)("p",null,Object(a.b)("em",{parentName:"p"},"Late August, 2020")),Object(a.b)("p",null,"From the ",Object(a.b)("em",{parentName:"p"},"Red Coast Base")," to ",Object(a.b)("em",{parentName:"p"},"Seeker Camp")," runtime upgrade, the\nstorage version of scheduler module was changed from ",Object(a.b)("inlineCode",{parentName:"p"},"V1")," to\n",Object(a.b)("inlineCode",{parentName:"p"},"V2"),". However, the corresponding runtime migration script for\nscheduler module wasn't included."),Object(a.b)("h3",{id:"impact-1"},"Impact"),Object(a.b)("p",null,"The following events happened that resulted in version mismatch of two\nscheduler storage items:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Referendum#4 was passed and was scheduled using the ",Object(a.b)("em",{parentName:"li"},"Red Coast Base"),"\nruntime, with scheduler storage version ",Object(a.b)("inlineCode",{parentName:"li"},"V1"),", at block 151,200."),Object(a.b)("li",{parentName:"ul"},"Referendum#5 was passed and was scheduled using the ",Object(a.b)("em",{parentName:"li"},"Red Coast Base"),"\nruntime, with scheduler storage version ",Object(a.b)("inlineCode",{parentName:"li"},"V1"),", at block 161,280."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("em",{parentName:"li"},"Seeker Camp")," runtime was activated at block 162,720, changing the\nscheduler module storage to version ",Object(a.b)("inlineCode",{parentName:"li"},"V2")," but did not run the\nmigration script.")),Object(a.b)("h3",{id:"resolution-1"},"Resolution"),Object(a.b)("p",null,"The issue is planned to be resolved by removing the automatic\nscheduling of referendum#4 and referendum#5, and manually enact\nreferendum#4 and referendum#5, using a fast-tracked democracy\nreferendum."),Object(a.b)("p",null,"A council motion with the preimage of the following root batch call\nwas submitted:"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},"Clear the storage prefix of ",Object(a.b)("inlineCode",{parentName:"li"},"Scheduler")," module, to remove the\nfaulty ",Object(a.b)("inlineCode",{parentName:"li"},"Agenda")," values."),Object(a.b)("li",{parentName:"ol"},"Set ",Object(a.b)("inlineCode",{parentName:"li"},"Scheduler::StorageVersion")," to ",Object(a.b)("inlineCode",{parentName:"li"},"V2")," manually."),Object(a.b)("li",{parentName:"ol"},"Enact referendum#4 manually."),Object(a.b)("li",{parentName:"ol"},"Enact referendum#5 manually.")),Object(a.b)("h2",{id:"module-index-change-in-runtime-upgrade"},"Module index change in runtime upgrade"),Object(a.b)("p",null,Object(a.b)("em",{parentName:"p"},"Late October, 2020")),Object(a.b)("p",null,"In the ",Object(a.b)("strong",{parentName:"p"},"Gondoa")," runtime upgrade, an accidential runtime module index\nchange happened."),Object(a.b)("h3",{id:"impact-2"},"Impact"),Object(a.b)("p",null,"This index change did not impact anything in the scheduler module, as\nwhen the runtime happened, no scheduling was in planned. However, the\nchange impacted all current democracy proposals and the current\ndemocracy referendum, rendering them invalid, because the\ndispatchables are stored on-chain."),Object(a.b)("p",null,"Past referenda and any on-chain transactions are not impacted by the\nmodule index change."),Object(a.b)("h3",{id:"resolution-2"},"Resolution"),Object(a.b)("p",null,"The council and the technical committee decided to work together to\ncancel the current democracy referendum and all current democracy\nproposals and to re-submit them again. Alternatively, the current\ndemocracy referendum can also be simply voted down by coin holders. If\nthe current demoracy referendum passes, it will do no harm to the\nchain but it will also be no-op, as the actual dispatachable is\nmissing."),Object(a.b)("h2",{id:"type-definition-incompatibility-between-ui-and-runtime"},"Type definition incompatibility between UI and runtime"),Object(a.b)("p",null,Object(a.b)("em",{parentName:"p"},"29 December, 2020")),Object(a.b)("p",null,"In the ",Object(a.b)("strong",{parentName:"p"},"Hotel Adriano")," runtime upgrade, an overlooked type\ndefinition was updated in runtime, but was not updated promptly in the\npolkadot.js UI, resulting in a brief period when the node will not\naccept transactions constructed by polkadot.js."),Object(a.b)("h3",{id:"impact-3"},"Impact"),Object(a.b)("p",null,"This incident only impacts polkadot.js UI, and does not impact node\nconsensus. However, as most exchanges and explorers depend on the\npolkadot.js library, it results in non-updated services unable to send\nextrinsics or parse extrinsics coming from the network."),Object(a.b)("h3",{id:"resolution-3"},"Resolution"),Object(a.b)("p",null,"The type definition update\nlink:",Object(a.b)("a",{parentName:"p",href:"https://github.com/polkadot-js/apps/pull/4281%5BPR%5D"},"https://github.com/polkadot-js/apps/pull/4281[PR]")," is submitted to\nthe polkadot.js repository. We're in the process of notifying\nexchanges and explorers about this update."))}u.isMDXComponent=!0},85:function(e,n,t){"use strict";t.d(n,"a",(function(){return s})),t.d(n,"b",(function(){return b}));var i=t(0),r=t.n(i);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var d=r.a.createContext({}),u=function(e){var n=r.a.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):c(c({},n),e)),t},s=function(e){var n=u(e.components);return r.a.createElement(d.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},m=r.a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,a=e.originalType,o=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),s=u(t),m=i,b=s["".concat(o,".").concat(m)]||s[m]||p[m]||a;return t?r.a.createElement(b,c(c({ref:n},d),{},{components:t})):r.a.createElement(b,c({ref:n},d))}));function b(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=t.length,o=new Array(a);o[0]=m;var c={};for(var l in n)hasOwnProperty.call(n,l)&&(c[l]=n[l]);c.originalType=e,c.mdxType="string"==typeof e?e:i,o[1]=c;for(var d=2;d<a;d++)o[d]=t[d];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,t)}m.displayName="MDXCreateElement"}}]);